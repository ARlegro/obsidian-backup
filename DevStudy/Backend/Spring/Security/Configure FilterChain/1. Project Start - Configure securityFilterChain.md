
### REST API 
![[PDF 8.png]]


### See SecurityConfiguration :
> for customize, need to know default SecurityConfiguration


**â˜‘ How to find**
- search :  Ctrl + N â¡ `SpringBootWebSecurityConfiguration`

â˜‘ **Core Structure (simplified)** â¡ defaultSecurityFilterChain
> Before reach dispatcherServelt, this filter will work 
```java
@ConditionalOnDefaultWebSecurity  
static class SecurityFilterChainConfiguration {  
    SecurityFilterChainConfiguration() {  
    }  
  
    @Bean  
    @Order(2147483642)  
    SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {  
        http.authorizeHttpRequests((requests) -> ((AuthorizeHttpRequestsConfigurer.AuthorizedUrl)requests.anyRequest()).authenticated());  
        http.formLogin(Customizer.withDefaults());  
        http.httpBasic(Customizer.withDefaults());  
        return (SecurityFilterChain)http.build();  
    }
```
ìë™ ì„¤ì •ì— ì˜í•´ ì¶”ê°€ë˜ëŠ” ê¸°ë³¸ filterChainë“¤ì„ ì„¤ì •í•˜ëŠ” Bean 
ë³´ë©´ ì¸ì¦, ì¸ê°€, í¼ ë¡œê·¸ì¸, http ê¸°ë³¸ ë“±ì˜ ì„¤ì •ì„ ì…‹íŒ…
<br>

ğŸ”Explanation
1. `http.authorizeHttpRequest( () -> ...)`
	- **Secure all incoming HTTP requests**
	- All requests require authentication.
	- Anonymouse people can't access APIs

2. `http.formLogin(Customizer.withDefaults());`
	- **Enable form-based login**  
	- Automatically **provides a default login pages** at `/login`
	- Provides the following behavior 
		- **Redirects** to `login?error` when fail to login 
		- **Redirects** to the original requested page when success to login
		- **Enables session-based authentication.**

 3. `http.httpBasic(Customizer.withDefaults());`
	 - **Enables HTTP Basic authentication**
	 - Credentials are sent in the Authorization header
	 - used for RESTful APIs or command-line toold

> [!Example ]
> - `formLogin()`
> 	- **ì›¹ í˜ì´ì§€ ê¸°ë°˜ UI ë¡œê·¸ì¸**
> 	- ë¸Œë¼ìš°ì €ìš© ë¡œê·¸ì¸ í¼ ì œê³µ
> - `httpBasic()`
> 	- **REST í´ë¼ì´ì–¸íŠ¸ë‚˜ API ë„êµ¬(Postman ë“±)ë¥¼ ìœ„í•œ ì¸ì¦** 
> 	- HTTP ìš”ì²­ í—¤ë”ë¥¼ í†µí•œ ì¸ì¦ ì§€ì› (RESTìš©)


>[!tip] For Customize, Override defaultSecurityFilterChain
 


### Customize Security Config

#### default config
```java
@Bean  
SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {  
    http.authorizeHttpRequests((requests) -> ((AuthorizeHttpRequestsConfigurer.AuthorizedUrl)requests.anyRequest()).authenticated());  
    http.formLogin(Customizer.withDefaults());  
    http.httpBasic(Customizer.withDefaults());  
    return (SecurityFilterChain)http.build();  
}
```

#### ë°”ê¿€ config 

##### â˜‘PermitAll() 
- **Permit all** given API
- anyRequest()).authenticated() â¡ anyRequest()).permitAll()
```java
...requests) -> ((.....AuthorizedUrl)requests.anyRequest()).permitAll());
```
- But it is not Secure
> [!WARNING] Never Use anyRequest + permitAll() â¡ very danger option

##### denyAll()
- **Deny all** given APIs (whether authorized or not)
```java
...requests) -> ((.....AuthorizedUrl)requests.anyRequest()).denyAll());
```
- 403 error : If i log in with correct ID and PW, the following screen will be displayed 
		![[Pasted image 20250519102343.png]]


##### requests.requestMatchers
> Apply this access rule to requests that match this pattern.
- Filters requests based on URL patterns
- used to **apply different security rules to specific request paths**
- used with : `.hasRole(), .permitAll(), .authenticated() etc`
- For example, 
```java
http.authorizeHttpRequests((requests) -> 
    requests
        .requestMatchers("/admin/**").hasRole("ADMIN")
        .requestMatchers("/api/public/**").permitAll()
        .anyRequest().authenticated()
);
```

| Path Pattern                 | Rule                                             |
| ---------------------------- | ------------------------------------------------ |
| /admin/**                    | **Accessible only** to users **with ADMIN ROLE** |
| /api/public/**               | **Accessible to everyone** (no login required)   |
| anyRequest().authenticated() | All **other reuqests require authentication**    |

> [!WARNING] What happens if write this : `.requestMathcers(~).ìƒëµ~.anyRequest()`
>- line `.requestMatchers("/admin/**")` **only defines a path pattern**.
>- But it **doesn't specify any access rule** 
>- Result : does not apply any explicit access control to that path.

