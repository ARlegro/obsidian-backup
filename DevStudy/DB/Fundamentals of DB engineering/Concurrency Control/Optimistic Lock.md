

### Preview 
- μ“°μ΄λ” κ²©λ¦¬ μμ¤€ : `READ COMMITTED`
- μ¥μ  β…
	- λ™μ‹μ„±μ΄ λ†’λ‹¤
	- λ°λ“λ½ κΈ°νκ°€ μ¤€λ‹¤.
- λ‹¨μ  π’Ά
	- μ¶©λ μ‹ νΈλμ­μ…μ΄ λ΅¤λ°±λμ–΄ μ¤λ²„ν—¤λ“κ°€ μΌμ–΄λ‚  μ μλ‹¤.

### λ™μ‘ μ›λ¦¬ 
- **λ°μ΄ν„°λ² μ΄μ¤ λ½μ„ μ§μ ‘ μ‚¬μ©ν•μ§€ μ•μ:** λ°μ΄ν„°λ² μ΄μ¤μ ν–‰ λ λ²¨ λ½(λΉ„κ΄€μ  λ½)μ„ μ§μ ‘ μ‚¬μ©ν•μ§€ μ•κ³ , μ• ν”λ¦¬μΌ€μ΄μ… λ λ²¨μ—μ„ `version` μ»¬λΌμ„ ν†µν•΄ μ¶©λμ„ κ°μ§€ν•λ‹¤.
- **μ„±λ¥ μ΄μ :** λ½μΌλ΅ μΈν• λ€κΈ°(λΈ”λ΅)κ°€ μ—†μ–΄ λ™μ‹μ„±μ΄ λ†’μ€ ν™κ²½μ—μ„ μ„±λ¥μƒ μ΄μ μ΄ μμ„ μ μλ‹¤. (μ¶©λμ΄ μ¦μΌλ©΄ μ¬μ‹λ„λ΅ μΈν•΄ λ¶λ¦¬ν•  μλ„ μμ)
- **μ¬μ‹λ„ λ΅μ§ ν•„μ:** μ¶©λ λ°μƒ μ‹ μμ™Έκ°€ λ°μƒν•λ―€λ΅, μ• ν”λ¦¬μΌ€μ΄μ… μ½”λ“κ°€ μ΄λ¥Ό μ²λ¦¬ν•κ³  ν•„μ”ν•λ©΄ μ¬μ‹λ„ν•λ” λ΅μ§μ„ κµ¬ν„ν•΄μ•Ό ν•λ‹¤.
- **JPA `@Version` μ§€μ›:** Spring Data JPAλ‚ Hibernateλ” `@Version` μ–΄λ…Έν…μ΄μ…μ„ ν†µν•΄ λ‚™κ΄€μ  λ½μ„ λ§¤μ° μ‰½κ² μ μ©ν•  μ μλ„λ΅ μ§€μ›ν•λ‹¤.

#### Flow

| T1                                                               | T2                                              | DB                                       |
| ---------------------------------------------------------------- | ----------------------------------------------- | ---------------------------------------- |
| νΈλμ­μ… μ‹μ‘                                                          | νΈλμ­μ… μ‹μ‘                                         | ID : 1<br>Status : Free<br>Version : 1   |
| Read Row ID : 1<br>(Row Version = 1)<br>(μ‰μ–΄λ½ κ±Έλ¦Ό - But μ½μλ§μ λ½ λ°λ‚©) | Read Row ID : 1<br>(T1κ³Ό λ‘κ°™μ)                    | ID : 1<br>Status : Free<br>Version : 1   |
| SELEDT FOR UPDATE<br>(λ²„μ „ κ²€μ¦ μΌμ–΄λ‚¨ + λ°°νƒ€λ½)                           |                                                 | ID : 1<br>Status : Free<br>Version : 1   |
| UPDATE                                                           |                                                 |                                          |
| COMMIT                                                           | (νΈλμ­μ… μ¤‘)                                        | ID : 1<br>Status : Booked<br>Version : 2 |
|                                                                  | `SELECT FOR UPDATE`<br>**(λ²„μ „ κ²€μ¦ μΌμ–΄λ‚¨ + λ°°νƒ€λ½ μ‹λ„)** | ID : 1<br>Status : Booked<br>Version : 2 |
|                                                                  | **ROLLBACKλ¨ Cuz λ²„μ „μ΄ μ΄μƒν•΄μ„**                      | ID : 1<br>Status : Booked<br>Version : 2 |

#### @Version β“
- μ¤ν”„λ§ λ°μ΄ν„°(Spring Data)λ” `@Version` μ–΄λ…Έν…μ΄μ…μ΄ λ¶™μ€ μ«μ νƒ€μ… μ†μ„±μ„ μ‚¬μ©ν•μ—¬ λ‚™κ΄€μ  λ½μ„ μ§€μ›
- @Versionμ΄ λ¶™μΌλ©΄ `UPDATE` μΏΌλ¦¬μ—λ” **λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥λ λ²„μ „μ΄ μ‹¤μ λ΅ λ³€κ²½λμ§€ μ•μ•λ”μ§€ ν™•μΈν•λ” `WHERE` μ μ΄ ν¬ν•¨**λλ‹¤.
- λ§μ•½ λ³€κ²½λμ—λ‹¤λ©΄, `OptimisticLockingFailureException`μ΄ λ°μƒ


### μλ°” μμ‹

μΌλ‹¨ ν…μ΄λΈ”μ€ μ•„λμ™€ κ°™μ•λ”λ°, Version ν•„λ“λ¥Ό μ¶”κ°€ν•  κ²ƒ 

```java
@Version
private int version;
```